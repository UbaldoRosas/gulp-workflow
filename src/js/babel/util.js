"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}var util=function(){var browser=navigator.userAgent;var is_chrome=browser.indexOf('Chrome')>-1;var is_explorer=browser.indexOf('MSIE')>-1;var is_firefox=browser.indexOf('Firefox')>-1;var is_safari=browser.indexOf('Safari')>-1;var is_opera=browser.toLowerCase().indexOf('op')>-1;if(is_chrome&&is_safari)is_safari=false;if(is_chrome&&is_opera)is_chrome=false;return{isMobile:function isMobile(){var check=false;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=true;})(navigator.userAgent||navigator.vendor||window.opera);return check;},isSafari:is_safari,isEmail:function isEmail(email){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);},isEmpty:function isEmpty(el){return!$.trim(el.html());},cleanString:function cleanString(s){var specialChars="!@#$^&%*()+=[]\/{}|:<>?,";for(var i=0;i<specialChars.length;i++){s=s.replace(new RegExp("\\"+specialChars[i],'gi'),'');}s=s.toLowerCase();s=s.replace(/ /g,"_");s=s.replace(/-/g,"_");s=s.replace(/á/gi,"a");s=s.replace(/é/gi,"e");s=s.replace(/í/gi,"i");s=s.replace(/ó/gi,"o");s=s.replace(/ú/gi,"u");s=s.replace(/ñ/gi,"n");return s;},adjustVideo:function adjustVideo(selector){var player=$(selector);var mediaAspect=16/9;var windowW=$(window)[0].innerWidth;var windowH=$(window).height();var windowAspect=windowW/windowH;if(windowAspect<mediaAspect){player.css({top:0,left:-(windowH*mediaAspect-windowW)/2,height:windowH,width:windowH*mediaAspect});}else{player.css({top:-(windowW/mediaAspect-windowH)/2,left:0,height:windowW/mediaAspect,width:windowW});}},ratioVideo:function ratioVideo(selector){if($(selector).length){$(selector).each(function(index,el){var $videos=$(this);var ratio=16/9;var wVideo=$(this).width();var hVideo=Math.ceil(wVideo/ratio);$videos.css('height',"".concat(hVideo,"px"));});}}};}();var isMobile=util.isMobile();var isSafari=util.isSafari;var windowWidth=window.innerWidth;var windowHeight=window.innerHeight;var API=function(){function API(){_classCallCheck(this,API);}_createClass(API,null,[{key:"filter_products",value:function filter_products(filter){if(filter!="todos"){products.hide();products.filter('[data-categoria="'+filter+'"]').show();}else{products.show();}}},{key:"add_product",value:function add_product(){dialog_buttons.prop('disabled',true);dialog_line.open();var form=$('#product-form')[0];var formData=new FormData(form);formData.append('tipo',form.tipo.value);$.ajax({type:"POST",url:"/api/add-producto",data:formData,contentType:false,cache:false,processData:false,success:function success(response){if(response){var product=JSON.parse(response);$('.cards-container').prepend(API.product_card(product));API.filter_products($('.mdc-tab--active').data('filter'));dialog_line.close();edit_dialog.close();snackbar.labelText='Producto agregado';snackbar.open();$('.product-card__edit-button').off('click').click(function(){API.get_product($(this).data('id'));});products=$('.product');$('.product-card__delete-button').off('click').click(function(){$(this).addClass('active');dialog_buttons.prop('disabled',false);delete_dialog.open();});}}});}},{key:"get_product",value:function get_product(id){$('#add-product-form-button').hide();$('#edit-product-form-button').show();$.ajax({type:"POST",url:"/api/get-product",data:{id:id},success:function success(response){var product=JSON.parse(response);API.clear_dialog_content();$('#product-image-folder').val(product.folder);$('#product-form-category').val(product.categoria);$('#product-form-unit').val(product.unidad);$('#product-form-name').val(product.nombre);$('#product-form-type').find('option[value="'+product.tipo.toLowerCase()+'"]').prop('selected',true);$('#product-form-description').val(product.descripcion);$('#product-form-peso-pieza').val(product.peso_pieza);$('#product-form-peso-caja').val(product.peso_caja);$('#product-form-temperatura').val(product.temperatura);$('#product-form-temperatura-transp').val(product.temperatura_transp);$('#product-form').attr('data-id',product.id);if(product.imagen!==""){$('#product-form-media').append(API.get_product_images(product));$('.product-image__card').eq(0).find('.hover-image-field').addClass('hide');if($('.product-image__card').length>1&&product.hover_image=="1"){$('.product-image__card').eq(1).find('.hover-image-check').prop('checked',true).addClass('active');}$('.main-image-check').change(function(event){$('.hover-image-field').removeClass('hide');$(this).parentsUntil('.product-image__card').find('.hover-image-field').addClass('hide').find('.hover-image-check').removeClass('active').prop('checked',false);});}$('.product-image__card-delete').click(function(){API.delete_dialog_image($(this));});var rapidin_checkbox=$('#product-form-rapidin');if(API.check_is_pollo()){$('#product-form-subcategory').find('option[value="'+product.subcategoria+'"]').attr('selected',true);$('label[for="product-form-subcategory"]').addClass('mdc-floating-label--float-above');product.rapidin=="1"?rapidin_checkbox.prop('checked',true):rapidin_checkbox.prop('checked',false);}else{rapidin_checkbox.prop('check',false);}$('.hover-image-check').change(function(){API.set_hover_image($(this));});$('#product-form-category').val()=="huevo"?$('option[value="congelado"]').prop({hidden:true,selected:false,disabled:true}).prev().prop('selected',true).parent().val('fresco'):$('option[value="congelado"]').prop({hidden:false,disabled:false});dialog_buttons.prop('disabled',false);dialog_line.close();edit_dialog.open();$('.mdc-dialog').find('.mdc-text-field__input').each(function(index,element){var $this=$(element);var label=$this.next().find('label');label.parent().removeAttr('style');if($this.val()!==""){label.addClass('mdc-floating-label--float-above');}else{label.removeClass('mdc-floating-label--float-above');}});}});}},{key:"edit_product",value:function edit_product(id){dialog_buttons.prop('disabled',true);dialog_line.open();var dialog_images=API.get_dialog_images();var form=$('#product-form')[0];var formData=new FormData(form);formData.append('id',id);if(dialog_images){formData.append('curr_images',dialog_images.all);if(dialog_images.hover!=""){formData.append('hover_image',"1");}else{formData.append('hover_image',"");}}else{formData.append('curr_images',"");formData.append('hover_image',"");}$.ajax({type:"POST",url:"/api/edit-product",data:formData,contentType:false,cache:false,processData:false,success:function success(response){if(response){var active_filter=$('.mdc-tab--active').data('filter');var product_card=$('.product').filter('[data-id="'+id+'"]');var src_image="";if(dialog_images){src_image+=dialog_images["default"];}if(product_card.length<1){var product=JSON.parse(response);$('.cards-container').prepend(API.product_card(product));setTimeout(function(){dialog_line.close();edit_dialog.close();snackbar.labelText='Producto agregado';snackbar.open();},1500);$('.product-card__edit-button').off('click').click(function(){API.get_product($(this).data('id'));});products=$('.product');$('.product-card__delete-button').off('click').click(function(){$(this).addClass('active');dialog_buttons.prop('disabled',false);delete_dialog.open();});}else{setTimeout(function(){product_card.attr('data-categoria',form.categoria.value);product_card.find('img').attr('src',"/assets/img/catalogo/".concat(id,"/").concat(src_image));product_card.find('.product-name').text(form.nombre.value);product_card.find('.product-unidad').text(form.unidad.value);API.filter_products(active_filter);dialog_line.close();edit_dialog.close();snackbar.labelText='Producto actualizado';snackbar.open();},1000);}}}});}},{key:"delete_product",value:function delete_product(id){$.ajax({type:"POST",url:"/api/delete-product",data:{id:id},success:function success(response){snackbar.labelText='Producto eliminado';snackbar.open();$('.product[data-id="'+id+'"]').remove();}});}},{key:"update_product_order",value:function update_product_order(prod_id,index){var data={id:prod_id,order:index};$.ajax({type:"post",url:"/api/update-prod-order",data:data,success:function success(response){console.log('response',response);}});}},{key:"get_uploaded_images",value:function get_uploaded_images(){var return_array=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var images=[];var images_object=$('#product-form-imagenes')[0].files;for(var image in images_object){if(images_object.hasOwnProperty(image)){var image_name=images_object[image].name;images.push(image_name);}}return return_array?images:images.join(', ');}},{key:"get_product_images",value:function get_product_images(product){var cards="";var arr_images=product.imagen.split(",");for(var i=0;i<arr_images.length;i++){var image=util.cleanString(arr_images[i]);var src="/assets/img/catalogo/".concat(product.id,"/").concat(image);if(deleted_images.indexOf(image)==-1){cards+=this.dialog_image_card(src,image,i);}}return cards;}},{key:"update_product_images",value:function update_product_images(product){var cards=this.get_product_images(product);$('.product-image__card').remove();$('#product-form-media').append(cards);$('.product-image__card').eq(0).find('.hover-image-field').addClass('hide');if(product.hover_image=="1"){$('.product-image__card').eq(1).find('.hover-image-check').addClass('active').prop('checked',true);}$('.hover-image-check').change(function(){API.set_hover_image($(this));});$('.main-image-check').change(function(event){$('.hover-image-field').removeClass('hide');$(this).parentsUntil('.product-image__card').find('.hover-image-field').addClass('hide').find('.hover-image-check').removeClass('active').prop('checked',false);});$('.product-image__card-delete').click(function(){API.delete_dialog_image($(this));});}},{key:"product_card",value:function product_card(product){var folder=product.id;var image="";if(product.imagenes){image=product.imagenes.split(",")[0];}return"<div class=\"product-card__container product\" data-id=\"".concat(product.id,"\" data-categoria=\"").concat(product.categoria,"\">\n                    <div class=\"mdc-card product-card\">\n                        <div tabindex=\"0\">\n                            <div class=\"mdc-card__media mdc-card__media--16-9 product-card__media\">\n                                <img src=\"/assets/img/catalogo/").concat(folder,"/").concat(image,"\" alt=\"\">\n                            </div>\n                            <div class=\"product-card__primary\">\n                                <h2 class=\"product-card__title product-name mdc-typography mdc-typography--headline6\" data-nombre>").concat(product.nombre,"</h2>\n                                <h3 class=\"product-card__subtitle product-unidad secondary-text mdc-typography mdc-typography--body2\" data-unidad>").concat(product.unidad,"</h3>\n                            </div>\n                        </div>\n                        <div class=\"mdc-card__actions\">\n                            <div class=\"mdc-card__action-buttons d-flex flex-justify-between min-w-full\">\n                                <button class=\"mdc-button mdc-card__action mdc-card__action--button product-card__edit-button\" data-id=\"").concat(product.id,"\">Editar</button>\n                                <span class=\"material-icons mdc-icon-button mdc-card__action mdc-card__action--icon product-card__delete-button\" title=\"Delete\" data-id=\"").concat(product.id,"\">delete</span>\n                            </div>\n                        </div>\n                    </div>\n                </div>");}},{key:"dialog_image_card",value:function dialog_image_card(src,image,forloop_index){var checked=forloop_index==0?'checked':'';return"\n            <div class=\"mdc-card product-card product-image__card\" data-image=\"".concat(image,"\">\n                <div tabindex=\"0\">\n                    <div class=\"mdc-card__media mdc-card__media--16-9\" style=\"background-image: url('").concat(src,"');\"></div>\n                    <div class=\"mdc-card__actions\">\n                        <div class=\"mdc-card__action-buttons min-w-full d-flex flex-justify-between\">\n                            <div>\n                                <div class=\"mdc-form-field main-image-field\">\n                                    <div class=\"mdc-radio\">\n                                        <input class=\"mdc-radio__native-control main-image-check\" type=\"radio\" id=\"").concat(image,"\" name=\"default_image\" value=\"").concat(image,"\" ").concat(checked,">\n                                        <div class=\"mdc-radio__background\">\n                                            <div class=\"mdc-radio__outer-circle\"></div>\n                                            <div class=\"mdc-radio__inner-circle\"></div>\n                                        </div>\n                                    </div>\n                                    <label for=\"").concat(image,"\">Principal</label>\n                                </div>\n                                <div class=\"mdc-form-field hover-image-field\">\n                                    <div class=\"mdc-checkbox\">\n                                        <input type=\"checkbox\" name=\"hover_image\" value=\"").concat(image,"\" class=\"mdc-checkbox__native-control hover-image-check\" id=\"hover-image-").concat(image,"\"/>\n                                        <div class=\"mdc-checkbox__background\">\n                                            <svg class=\"mdc-checkbox__checkmark\" viewBox=\"0 0 24 24\">\n                                                <path class=\"mdc-checkbox__checkmark-path\" fill=\"none\" d=\"M1.73,12.91 8.1,19.28 22.79,4.59\"/>\n                                            </svg>\n                                            <div class=\"mdc-checkbox__mixedmark\"></div>\n                                        </div>\n                                    </div>\n                                    <label for=\"hover-image-").concat(image,"\">Hover</label>\n                                </div>\n                            </div>\n                            <span class=\"material-icons mdc-icon-button mdc-card__action mdc-card__action--icon product-image__card-delete\" title=\"Delete\">delete</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ");}},{key:"get_dialog_images",value:function get_dialog_images(){if($('.product-image__card').length>0){var default_image=$('.product-image__card').find('.mdc-radio__native-control:checked')[0].value;var hover_image=$('.hover-image-check:checked').length>0?$('.hover-image-check:checked')[0].value:"";var images={"default":default_image,hover:hover_image,all:default_image+(hover_image!=""?","+hover_image:"")};$('.product-image__card').each(function(){var image=$(this).data('image');if(image!==default_image&&image!==hover_image)images.all+=",".concat(image);});return images;}return false;}},{key:"delete_dialog_image",value:function delete_dialog_image(button){var item_is_checked=button.prev().find('.mdc-radio__native-control:checked').length>0;var image_card=button.parentsUntil('.product-card').parent();deleted_images.push(image_card.attr('data-image'));image_card.remove();if(item_is_checked){$('.product-image__card').eq(0).find('.mdc-radio__native-control').prop('checked',true).parentsUntil('.mdc-card__action-buttons').siblings('.hover-image-field').addClass('hide').find('.hover-image-check').removeClass('active').addClass('hide').prop('checked',false);}}},{key:"clear_dialog_content",value:function clear_dialog_content(){product_form.trigger('reset');$('#product-form-media').html('');$('#info-imagenes').text('');$('option[value="congelado"]').prop({hidden:false,disabled:false});}},{key:"check_is_pollo",value:function check_is_pollo(){var pollo_options=$('#product-form-pollo-options');var subcategory_hidden_option=$('#product-form-subcategory-option-hidden');if($('#product-form-category').find('option:selected').val()=="pollo"){subcategory_hidden_option.prop('hidden',true).attr('selected',false);show(pollo_options);return true;}else{subcategory_hidden_option.prop('hidden',false).attr('selected',true);hide(pollo_options);return false;}}},{key:"set_hover_image",value:function set_hover_image(checkbox){if(checkbox.hasClass('active')){checkbox.removeClass('active').prop('checked',false);}else{$('.hover-image-check').removeClass('active').prop('checked',false);checkbox.addClass('active').prop('checked',true);}}}]);return API;}();